<html>
<body>
<script>
	var audio_context;
	var snd_names = ["LA_Chest_Open","jump"];
	var snd_index = 0;
	
	window.onload = function(){
		audio_context = new AudioContext();
		readSound();
	}
	
	var readSound = function(){		
		if (snd_index >= snd_names.length) return;
		
		var url = "witch/assets/sounds/" + snd_names[snd_index] + ".mp3";
		snd_index++;
		
		// Load buffer asynchronously
		var request = new XMLHttpRequest();
		request.open("GET", url, true);
		request.responseType = "arraybuffer";

		request.onload = function() {
		// Asynchronously decode the audio file data in request.response
		audio_context.decodeAudioData(
		  request.response,
		  function(_buffer) {
			if (!_buffer) {
			  alert('error decoding file data: ' + url);
			  return;
			}
			playSound(_buffer, 0.5);
			readSound();
		  },
		  function(error) {
			console.error('decodeAudioData error', error);
		  }
		);}
		
		request.send();	
	}
	
	var playSound = function(buffer, volume, time){
		//http://www.html5rocks.com/en/tutorials/webaudio/intro/
		var source = audio_context.createBufferSource(); //creates a sound source
		source.buffer = buffer; //tell the source which sound to play
		
		var v = volume || 1.0;
		//Create a gain node
		var gain_node = audio_context.createGain();
		source.connect(gain_node);
		gain_node.connect(audio_context.destination); //connect source to the speakers
		
		//Set the volume
		gain_node.gain.value = v;

		
		var t = time || 0;
		if (source.start)
			source.start(t); 
		//NOTE: on older systems, may have to use deprecated noteOn(time);
		else
			source.noteOn(t);
	}
</script>
</body>
</html>